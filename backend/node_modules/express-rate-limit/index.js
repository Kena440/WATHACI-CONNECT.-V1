function rateLimit(options = {}) {
  const windowMs = options.windowMs || 60 * 1000;
  const max = options.max ?? 5;
  const hits = new Map();
  setInterval(() => hits.clear(), windowMs).unref();
  return (req, res, next) => {
    const key = req.ip || req.connection.remoteAddress || 'global';
    const count = hits.get(key) || 0;
    if (count >= max) {
      res.status(429).send('Too many requests');
      return;
    }
    hits.set(key, count + 1);
    next();
  };
}
module.exports = rateLimit;
